{% extends 'seller/seller_index.html' %}

{% block content %}
<div class="container mt-4">
  <h3>Your Product Orders</h3>

  {% if orders_with_payments %}
  <div class="table-responsive mt-3">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Order #</th>
          <th>Date</th>
          <th>Customer</th>
          <th>Products</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Payment</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>

        {% for data in orders_with_payments %}
        <tr>
          <td>#{{ data.order.id }}</td>
          <td>{{ data.order.order_date|date:"M d, Y" }}</td>
          <td>{{ data.order.user.name }}</td>

          <!-- Products -->
          <td>
            {% for item in data.order.items.all %}
              {% if item.product.seller.id == request.session.id %}
                {{ item.product.name }}<br>
              {% endif %}
            {% endfor %}
          </td>

          <!-- Quantity -->
          <td>
            {% for item in data.order.items.all %}
              {% if item.product.seller.id == request.session.id %}
                {{ item.quantity }}<br>
              {% endif %}
            {% endfor %}
          </td>

          <td>â‚¹{{ data.order.total_amount }}</td>

          <!-- Payment -->
          <td>
            {% if data.payment %}
              <span class="badge 
                {% if data.payment.is_successful %}
                  bg-success
                {% else %}
                  bg-danger
                {% endif %}
              ">
                {{ data.payment.get_payment_method_display }}
              </span>
            {% else %}
              <span class="badge bg-secondary">
                Pending
              </span>
            {% endif %}
          </td>

          <td>
            <a href="{% url 'seller_order_detail' data.order.id %}" 
               class="btn btn-sm btn-info">
              View
            </a>
          </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>
  {% else %}
    <div class="alert alert-info mt-3">
      No orders found.
    </div>
  {% endif %}
</div>
{% endblock %}
